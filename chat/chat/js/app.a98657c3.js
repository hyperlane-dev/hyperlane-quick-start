(function(){"use strict";var e={3375:function(e,t,n){var s=n(5130),o=n(6768);function i(e,t,n,s,i,r){const a=(0,o.g2)("router-view"),l=(0,o.g2)("ToastContainer");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(a),(0,o.bF)(l,{ref:"toastContainer"},null,512)],64)}const r={class:"toast-container"};function a(e,t,n,s,i,a){const l=(0,o.g2)("ToastNotification");return(0,o.uX)(),(0,o.CE)("div",r,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.toasts,(e=>((0,o.uX)(),(0,o.Wv)(l,{key:e.id,message:e.message,type:e.type,duration:e.duration,visible:e.visible,onClose:t=>a.removeToast(e.id)},null,8,["message","type","duration","visible","onClose"])))),128))])}n(4114);var l=n(4232);const c={class:"toast-content"},u={class:"toast-message"};function d(e,t,n,i,r,a){return(0,o.uX)(),(0,o.Wv)(s.eB,{name:"toast"},{default:(0,o.k6)((()=>[n.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,l.C4)(["toast",`toast-${n.type}`])},[(0,o.Lk)("div",c,[(0,o.Lk)("i",{class:(0,l.C4)(a.iconClass)},null,2),(0,o.Lk)("span",u,(0,l.v_)(n.message),1)])],2)):(0,o.Q3)("",!0)])),_:1})}var h={name:"ToastNotification",props:{message:{type:String,required:!0},type:{type:String,default:"info",validator:e=>["info","success","warning","error"].includes(e)},duration:{type:Number,default:1e3},visible:{type:Boolean,default:!1}},computed:{iconClass(){const e={info:"toast-icon-info",success:"toast-icon-success",warning:"toast-icon-warning",error:"toast-icon-error"};return e[this.type]||e.info}}},m=n(1241);const p=(0,m.A)(h,[["render",d],["__scopeId","data-v-be2693da"]]);var g=p,f={name:"ToastContainer",components:{ToastNotification:g},data(){return{toasts:[],nextId:1,currentToastTimer:null}},methods:{addToast(e){if(this.currentToastTimer&&(clearTimeout(this.currentToastTimer),this.currentToastTimer=null),this.toasts.length>0)this.toasts[0].message=e.message||"",this.toasts[0].type=e.type||"info",this.toasts[0].duration=e.duration||1e3;else{const t={id:this.nextId++,message:e.message||"",type:e.type||"info",duration:e.duration||1e3,visible:!0};this.toasts.push(t)}const t=e.duration||1e3;return this.currentToastTimer=setTimeout((()=>{this.clearAll(),this.currentToastTimer=null}),t),this.toasts[0].id},removeToast(){this.currentToastTimer&&(clearTimeout(this.currentToastTimer),this.currentToastTimer=null),this.clearAll()},clearAll(){this.toasts=[],this.currentToastTimer&&(clearTimeout(this.currentToastTimer),this.currentToastTimer=null)}},beforeUnmount(){this.currentToastTimer&&clearTimeout(this.currentToastTimer)}};const v=(0,m.A)(f,[["render",a],["__scopeId","data-v-286c2e8c"]]);var w=v;class S{constructor(){this.container=null}setContainer(e){this.container=e}info(e,t=1e3){return this.show({message:e,type:"info",duration:t})}success(e,t=1e3){return this.show({message:e,type:"success",duration:t})}warning(e,t=1e3){return this.show({message:e,type:"warning",duration:t})}error(e,t=1e3){return this.show({message:e,type:"error",duration:t})}show(e){return this.container?this.container.addToast(e):null}remove(e){this.container&&this.container.removeToast(e)}clear(){this.container&&this.container.clearAll()}}const k=new S;var y={name:"App",components:{ToastContainer:w},mounted(){k.setContainer(this.$refs.toastContainer)}};const b=(0,m.A)(y,[["render",i]]);var C=b,T=n(1387);const M={class:"chat-view"},x={class:"nav-bar"},$={class:"chat-container"};function L(e,t,n,s,i,r){const a=(0,o.g2)("MessageList"),c=(0,o.g2)("ScrollToBottomButton"),u=(0,o.g2)("ConnectionStatus"),d=(0,o.g2)("ChatInput");return(0,o.uX)(),(0,o.CE)("div",M,[(0,o.Lk)("div",x,[t[1]||(t[1]=(0,o.Lk)("div",{class:"nav-left"},[(0,o.Lk)("img",{src:"https://docs.ltpp.vip/img/hyperlane.png",alt:"",class:"nav-logo"}),(0,o.Lk)("h1",{class:"nav-title"},[(0,o.Lk)("a",{href:"https://github.com/hyperlane-dev/hyperlane",target:"_blank"}," Hyperlane Chat ")])],-1)),(0,o.Lk)("div",{class:(0,l.C4)(["connection-indicator",i.connectionStatus])},[t[0]||(t[0]=(0,o.Lk)("span",{class:"status-dot"},null,-1)),(0,o.eW)(" "+(0,l.v_)("connected"===i.connectionStatus?"Online":"Offline"),1)],2)]),(0,o.Lk)("div",$,[(0,o.bF)(a,{messages:i.messages,isNearBottom:i.isNearBottom,name:i.username,onHandleScroll:r.handleScroll,onMentionUser:r.handleMentionUser,ref:"messageListRef"},null,8,["messages","isNearBottom","name","onHandleScroll","onMentionUser"]),i.showScrollButton?((0,o.uX)(),(0,o.Wv)(c,{key:0,unreadCount:i.unreadCount,onClick:r.scrollToBottom},null,8,["unreadCount","onClick"])):(0,o.Q3)("",!0),"connected"!==i.connectionStatus?((0,o.uX)(),(0,o.Wv)(u,{key:1,status:i.connectionStatus},null,8,["status"])):(0,o.Q3)("",!0),(0,o.bF)(d,{connectionStatus:i.connectionStatus,onlineCountText:i.onlineCountText,onSendMessage:r.sendMessage,ref:"chatInputRef"},null,8,["connectionStatus","onlineCountText","onSendMessage"])])])}const U={class:"message-info"},I={class:"message-content gpt-response"},_={class:"message-time"},B={class:"message-info"},E={class:"message-content"},A={class:"message-time"},H={class:"message-info self"},D={class:"message-content self"},F={class:"message-time"};function R(e,t,n,s,i,r){const a=(0,o.g2)("MessageAvatar"),c=(0,o.g2)("MessageHeader"),u=(0,o.g2)("MessageText"),d=(0,o.g2)("ScrollList");return(0,o.uX)(),(0,o.Wv)(d,{class:"chat-messages",ref:"messageContainer",items:n.messages,containerHeight:i.containerHeight,estimatedItemHeight:80,bufferSize:5,onHandleScroll:r.handleScroll},{default:(0,o.k6)((({item:e})=>[(0,o.Lk)("div",{class:(0,l.C4)(["message",r.isMe(e)&&!e.isGptResponse?"self-message":"other-message",e.isGptResponse?"gpt-message":""])},[e.isGptResponse?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)(a,{name:"gpt",isSelf:!1,isGpt:!0}),(0,o.Lk)("div",U,[(0,o.bF)(c,{name:"gpt",time:e.time,isSelf:!1,isGpt:!0,onMentionUser:r.handleMentionUser},null,8,["time","onMentionUser"]),(0,o.Lk)("div",I,[(0,o.bF)(u,{text:e.data},null,8,["text"])]),(0,o.Lk)("div",_,(0,l.v_)(e.time),1)])],64)):r.isMe(e)?((0,o.uX)(),(0,o.CE)(o.FK,{key:2},[(0,o.Lk)("div",H,[(0,o.bF)(c,{name:e.name,time:e.time,isSelf:!0,onMentionUser:r.handleMentionUser},null,8,["name","time","onMentionUser"]),(0,o.Lk)("div",D,[(0,o.bF)(u,{text:e.data},null,8,["text"])]),(0,o.Lk)("div",F,(0,l.v_)(e.time),1)]),(0,o.bF)(a,{name:e.name,isSelf:!0},null,8,["name"])],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.bF)(a,{name:e.name,isSelf:!1},null,8,["name"]),(0,o.Lk)("div",B,[(0,o.bF)(c,{name:e.name,time:e.time,isSelf:!1,onMentionUser:r.handleMentionUser},null,8,["name","time","onMentionUser"]),(0,o.Lk)("div",E,[(0,o.bF)(u,{text:e.data},null,8,["text"])]),(0,o.Lk)("div",A,(0,l.v_)(e.time),1)])],64))],2)])),_:1},8,["items","containerHeight","onHandleScroll"])}function X(e,t,n,s,i,r){return(0,o.uX)(),(0,o.CE)("div",{class:(0,l.C4)(["avatar",n.isSelf?"self":"",n.isGpt?"gpt":""])},(0,l.v_)(n.isGpt?"ðŸ¤–":n.name?.charAt(0)),3)}var O={name:"MessageAvatar",props:{name:{type:String,required:!0},isSelf:{type:Boolean,default:!1},isGpt:{type:Boolean,default:!1}}};const K=(0,m.A)(O,[["render",X],["__scopeId","data-v-d0ebf6d2"]]);var N=K;const P={class:"message-header"};function G(e,t,n,s,i,r){return(0,o.uX)(),(0,o.CE)("div",P,[(0,o.Lk)("div",{class:(0,l.C4)(["name",n.isGpt?"gpt-name":"",n.isGpt||n.isSelf?"":"clickable"]),onClick:t[0]||(t[0]=(...e)=>r.handleNameClick&&r.handleNameClick(...e))},(0,l.v_)(n.name),3)])}var z={name:"MessageHeader",props:{name:{type:String,required:!0},time:{type:String,required:!0},isSelf:{type:Boolean,default:!1},isGpt:{type:Boolean,default:!1}},methods:{handleNameClick(){this.isGpt||this.isSelf||this.$emit("mention-user",this.name)}}};const W=(0,m.A)(z,[["render",G],["__scopeId","data-v-fe0786e2"]]);var q=W;const j=["innerHTML"];function Q(e,t,n,s,i,r){return(0,o.uX)(),(0,o.CE)("div",{class:"message-text",innerHTML:r.formattedText},null,8,j)}var J=n(4911),Y=n(3873),V=n.n(Y),Z=n(4963);const ee=function(){const e="browser_uuid";let t=localStorage.getItem(e);return t||(t=(0,Z.A)(),localStorage.setItem(e,t)),t};var te={name:"MessageText",props:{text:{type:String,required:!0}},computed:{formattedText(){const e=this.renderMarkdown(this.text);return this.formatMentions(e)}},data(){return{md:null}},mounted(){this.md=new J.A({html:!0,linkify:!0,typographer:!0,breaks:!0}).use(V()).use(this.customLinkPlugin).use(this.customImagePlugin)},methods:{customLinkPlugin(e){const t=e.renderer.rules.link_open||function(e,t,n,s,o){return o.renderToken(e,t,n)};e.renderer.rules.link_open=function(e,n,s,o,i){const r=e[n];return r.attrSet("target","_blank"),r.attrSet("rel","noopener noreferrer"),t(e,n,s,o,i)}},customImagePlugin(e){const t=e.renderer.rules.image||function(e,t,n,s,o){return o.renderToken(e,t,n)};e.renderer.rules.image=function(e,n,s,o,i){const r=e[n];return r.attrSet("class","markdown-image"),t(e,n,s,o,i)}},renderMarkdown(e){try{return this.md?this.md.render(e):e}catch(t){return console.error("Markdown parsing error:",t),e}},formatMentions(e){const t=ee(),n=`User${t}`,s=/@([^\s@]+|"[^"]+"|'[^']+'|[\u4e00-\u9fa5]+\d*)/g;return e.replace(s,((e,s)=>{const o=s.replace(/^["']|["']$/g,""),i=this.isCurrentUser(o,t,n);return i?`<span class="mention mention-self">${e}</span>`:`<span class="mention mention-other">${e}</span>`}))},isCurrentUser(e,t,n){const s=[t,n,"me","Me","ME","@me"];return s.some((t=>e.toLowerCase()===t.toLowerCase()))}}};const ne=(0,m.A)(te,[["render",Q],["__scopeId","data-v-9957163a"]]);var se=ne;const oe={class:"list-content"};function ie(e,t,n,s,i,r){return(0,o.uX)(),(0,o.CE)("div",{class:"list-container",ref:"container",onScroll:t[0]||(t[0]=(...e)=>r.onScroll&&r.onScroll(...e)),style:(0,l.Tr)({height:n.containerHeight+"px"})},[(0,o.Lk)("div",oe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.items,((t,n)=>(0,o.RG)(e.$slots,"default",{item:t,index:n,key:n},void 0,!0))),128))])],36)}var re={name:"ScrollList",props:{items:{type:Array,required:!0},containerHeight:{type:Number,default:500}},data(){return{canScroll:!1}},methods:{onScroll(e){const t=e.target,n=t.scrollTop,s=t.clientHeight,o=t.scrollHeight,i=o-n-s,r=i<100;this.$emit("handleScroll",r)},scrollToBottom(){if(!this.$refs.container)return;const e=this.$refs.container,t=e.scrollHeight,n=e.clientHeight;t>n&&requestAnimationFrame((()=>{e.scrollTop=e.scrollHeight}))},checkScrollable(){if(!this.$refs.container)return!1;const e=this.$refs.container,t=e.scrollHeight,n=e.clientHeight;return this.canScroll=t>n,this.canScroll}},watch:{items:{handler(){this.$nextTick((()=>{this.checkScrollable()}))},deep:!0}}};const ae=(0,m.A)(re,[["render",ie],["__scopeId","data-v-40835dff"]]);var le=ae,ce={name:"MessageList",components:{MessageAvatar:N,MessageHeader:q,MessageText:se,ScrollList:le},props:{messages:{type:Array,required:!0},isNearBottom:{type:Boolean,default:!0},name:{type:String,required:!0}},data(){return{containerHeight:0,shouldAutoScroll:!0}},mounted(){this.updateContainerHeight(),window.addEventListener("resize",this.updateContainerHeight)},beforeUnmount(){window.removeEventListener("resize",this.updateContainerHeight)},methods:{isMe(e){return e?.name==ee()},updateContainerHeight(){this.containerHeight=window.innerHeight-108},scrollToBottom(){const e=this.$refs.messageContainer;if(e){const t=e.checkScrollable();t&&e.scrollToBottom()}},handleScroll(e){const t=this.$refs.messageContainer;t&&t.canScroll?this.$emit("handleScroll",e):this.$emit("handleScroll",!0)},handleMentionUser(e){this.$emit("mention-user",e)}},watch:{messages:{handler(){this.$nextTick((()=>{const e=this.$refs.messageContainer;if(e){const t=e.checkScrollable();t&&this.shouldAutoScroll&&this.scrollToBottom()}}))},deep:!0}}};const ue=(0,m.A)(ce,[["render",R],["__scopeId","data-v-cdaf495e"]]);var de=ue;const he={class:"chat-input",ref:"chatInputContainer"},me=["placeholder","disabled"],pe=["disabled"];function ge(e,t,n,i,r,a){const l=(0,o.g2)("UserMentionDropdown");return(0,o.uX)(),(0,o.CE)("div",he,[(0,o.bo)((0,o.Lk)("textarea",{ref:"messageInput","onUpdate:modelValue":t[0]||(t[0]=e=>r.message=e),onKeydown:t[1]||(t[1]=(...e)=>a.handleKeyDown&&a.handleKeyDown(...e)),onKeyup:t[2]||(t[2]=(...e)=>a.handleKeyUp&&a.handleKeyUp(...e)),onInput:t[3]||(t[3]=(...e)=>a.handleInput&&a.handleInput(...e)),placeholder:a.placeholderText,disabled:"connected"!==n.connectionStatus,rows:"1"},null,40,me),[[s.Jo,r.message]]),(0,o.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>a.sendMessage&&a.sendMessage(...e)),disabled:"connected"!==n.connectionStatus},t[5]||(t[5]=[(0,o.Lk)("span",null,"Send",-1),(0,o.Lk)("i",{class:"send-icon"},"âž¤",-1)]),8,pe),(0,o.bF)(l,{visible:r.showMentionDropdown,users:r.onlineUsers,filter:r.mentionFilter,position:r.dropdownPosition,loading:r.loadingUsers,onSelectUser:a.selectMentionUser,onClose:a.closeMentionDropdown},null,8,["visible","users","filter","position","loading","onSelectUser","onClose"])],512)}const fe={class:"mention-list"},ve={key:0,class:"loading-container"},we=["onClick","onMouseenter"],Se={class:"user-info"},ke={key:0,class:"no-users"};function ye(e,t,n,s,i,r){return n.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"mention-dropdown",style:(0,l.Tr)(r.dropdownStyle)},[t[1]||(t[1]=(0,o.Lk)("div",{class:"mention-header"},"Select User",-1)),(0,o.Lk)("div",fe,[n.loading?((0,o.uX)(),(0,o.CE)("div",ve,t[0]||(t[0]=[(0,o.Lk)("div",{class:"loading-spinner"},null,-1),(0,o.Lk)("div",{class:"loading-text"},"Loading users...",-1)]))):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.filteredUsers,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:e.user_id,class:(0,l.C4)(["mention-item",{active:t===i.selectedIndex,"gpt-user":"gpt"===e.user_id}]),onClick:t=>r.selectUser(e),onMouseenter:e=>i.selectedIndex=t},[(0,o.Lk)("div",{class:(0,l.C4)(["user-avatar",{"gpt-avatar":"gpt"===e.username,"other-user-avatar":"gpt"!==e.username}])},(0,l.v_)("gpt"===e.username?"ðŸ¤–":e.username.charAt(0)),3),(0,o.Lk)("div",Se,[(0,o.Lk)("div",{class:(0,l.C4)(["user-name",{"gpt-name":"GPT"===e.username}])},(0,l.v_)(e.username),3)])],42,we)))),128)),0===r.filteredUsers.length?((0,o.uX)(),(0,o.CE)("div",ke," No matching users found ")):(0,o.Q3)("",!0)],64))])],4)):(0,o.Q3)("",!0)}n(8111),n(2489);var be={name:"UserMentionDropdown",props:{visible:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},filter:{type:String,default:""},position:{type:Object,default:()=>({x:0,y:0,maxHeight:200})},loading:{type:Boolean,default:!1}},data(){return{selectedIndex:0}},computed:{filteredUsers(){if(!this.filter)return this.users;const e=this.filter.toLowerCase();return this.users.filter((t=>t.username.toLowerCase().includes(e)))},dropdownStyle(){return{maxHeight:`${this.position.maxHeight||200}px`}}},watch:{filteredUsers(){this.selectedIndex=0},visible(e){e&&(this.selectedIndex=0,this.$nextTick((()=>{this.scrollToSelected()})))}},methods:{selectUser(e){this.$emit("select-user",e)},handleKeyDown(e){if(this.visible)switch(e.key){case"ArrowDown":e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,this.filteredUsers.length-1),this.scrollToSelected();break;case"ArrowUp":e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,0),this.scrollToSelected();break;case"Enter":e.preventDefault(),this.filteredUsers[this.selectedIndex]&&this.selectUser(this.filteredUsers[this.selectedIndex]);break;case"Escape":e.preventDefault(),this.$emit("close");break}},scrollToSelected(){this.$nextTick((()=>{const e=this.$el.querySelector(".mention-list"),t=this.$el.querySelector(".mention-item.active");if(e&&t){const n=e.getBoundingClientRect(),s=t.getBoundingClientRect();s.bottom>n.bottom?e.scrollTop+=s.bottom-n.bottom:s.top<n.top&&(e.scrollTop-=n.top-s.top)}}))}},mounted(){document.addEventListener("keydown",this.handleKeyDown)},beforeUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}};const Ce=(0,m.A)(be,[["render",ye],["__scopeId","data-v-59fc3c8e"]]);var Te=Ce,Me={name:"ChatInput",components:{UserMentionDropdown:Te},props:{connectionStatus:{type:String,required:!0},onlineCountText:{type:String,default:""}},data(){return{message:"",showMentionDropdown:!1,mentionFilter:"",mentionStartIndex:-1,onlineUsers:[],dropdownPosition:{x:0,y:0},loadingUsers:!1,isMobile:!1}},computed:{placeholderText(){const e=this.isMobile?"(use @name to mention users)":"(use @name to mention users, ctrl+enter or shift+enter for new line)";return this.onlineCountText?`${this.onlineCountText} ${e}`:e}},mounted(){this.checkMobile(),window.addEventListener("resize",this.checkMobile),this.$nextTick((()=>{this.autoResize()}))},beforeUnmount(){window.removeEventListener("resize",this.checkMobile)},methods:{sendMessage(){"connected"===this.connectionStatus&&(this.message.trim()?(this.$emit("send-message",this.message),this.message="",this.closeMentionDropdown(),this.$nextTick((()=>{this.autoResize()}))):k.warning("Please enter a message before sending."))},addMention(e){const t=`@${e} `;this.message.trim()?this.message+=" "+t:this.message=t,this.$nextTick((()=>{const e=this.$refs.messageInput;e&&(e.focus(),e.setSelectionRange(e.value.length,e.value.length))}))},async fetchOnlineUsers(){if(!this.loadingUsers){this.loadingUsers=!0;try{const e=window.location.protocol,t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"localhost:60006":window.location.hostname,n=await fetch(`${e}//${t}/api/users/online`);if(n.ok){const e=await n.json();this.onlineUsers=e.users||[]}}catch(e){console.error("Failed to fetch online users list:",e),this.onlineUsers=[]}finally{this.loadingUsers=!1}}},handleKeyDown(e){if((!this.showMentionDropdown||!["ArrowDown","ArrowUp","Enter","Escape"].includes(e.key))&&"Enter"===e.key&&!this.showMentionDropdown)if(this.isMobile||!e.ctrlKey&&!e.shiftKey)e.preventDefault(),this.sendMessage();else{e.preventDefault();const t=this.$refs.messageInput,n=t.selectionStart,s=t.selectionEnd,o=t.value;this.message=o.substring(0,n)+"\n"+o.substring(s),this.$nextTick((()=>{t.selectionStart=t.selectionEnd=n+1,this.autoResize()}))}},handleKeyUp(){this.checkMentionTrigger()},handleInput(){this.checkMentionTrigger(),this.autoResize()},checkMobile(){const e=this.isMobile;this.isMobile=window.innerWidth<=768,e!==this.isMobile&&this.$nextTick((()=>{this.autoResize()}))},autoResize(){const e=this.$refs.messageInput;if(e)if(this.isMobile){const t=20;e.style.height=t+"px",e.style.overflowY="hidden"}else{e.style.height="auto";const t=20,n=t,s=2*t,o=Math.max(e.scrollHeight,n),i=Math.min(o,s);e.style.height=i+"px",e.scrollHeight>s?e.style.overflowY="auto":e.style.overflowY="hidden"}},checkMentionTrigger(){const e=this.$refs.messageInput,t=e.selectionStart,n=this.message;let s=-1;for(let o=t-1;o>=0;o--){if("@"===n[o]){s=o;break}if(" "===n[o]||"\n"===n[o])break}if(-1!==s){const o=n.substring(s+1,t);this.mentionFilter=o,this.mentionStartIndex=s,this.showMentionDropdown||(this.showMentionDropdown=!0,this.fetchOnlineUsers()),this.calculateDropdownPosition(e,s)}else this.closeMentionDropdown()},calculateDropdownPosition(e){const t=this.$refs.chatInputContainer.getBoundingClientRect(),n=e.getBoundingClientRect(),s=document.createElement("canvas"),o=s.getContext("2d"),i=window.getComputedStyle(e);o.font=`${i.fontSize} ${i.fontFamily}`;const r=n.top-20,a=Math.max(120,Math.min(250,r-6)),l=280,c=t.width,u=12;let d=u;d+l>c&&(d=c-l),d<0&&(d=0),this.dropdownPosition={x:d,maxHeight:a}},selectMentionUser(e){const t=this.message.substring(0,this.mentionStartIndex),n=this.message.substring(this.$refs.messageInput.selectionStart);this.message=t+`@${e.username} `+n,this.closeMentionDropdown(),this.$nextTick((()=>{const n=t.length+e.username.length+2;this.$refs.messageInput.setSelectionRange(n,n),this.$refs.messageInput.focus()}))},closeMentionDropdown(){this.showMentionDropdown=!1,this.mentionFilter="",this.mentionStartIndex=-1}}};const xe=(0,m.A)(Me,[["render",ge],["__scopeId","data-v-c9461bde"]]);var $e=xe;const Le={class:"connection-status"};function Ue(e,t,n,s,i,r){return(0,o.uX)(),(0,o.CE)("div",Le,[t[0]||(t[0]=(0,o.Lk)("i",{class:"status-icon"},"âš ï¸",-1)),(0,o.eW)(" "+(0,l.v_)(r.statusMessage),1)])}var Ie={name:"ConnectionStatus",props:{status:{type:String,required:!0}},computed:{statusMessage(){const e={disconnected:"æœªè¿žæŽ¥åˆ°æœåŠ¡å™¨",connecting:"æ­£åœ¨è¿žæŽ¥...",connected:"å·²è¿žæŽ¥"};return e[this.status]||"æœªçŸ¥çŠ¶æ€"}}};const _e=(0,m.A)(Ie,[["render",Ue],["__scopeId","data-v-7fb92132"]]);var Be=_e;const Ee={key:0,class:"unread-count"};function Ae(e,t,n,s,i,r){return(0,o.uX)(),(0,o.CE)("div",{class:"scroll-to-bottom",onClick:t[0]||(t[0]=t=>e.$emit("click"))},[n.unreadCount>0?((0,o.uX)(),(0,o.CE)("span",Ee,(0,l.v_)(n.unreadCount),1)):(0,o.Q3)("",!0),t[1]||(t[1]=(0,o.Lk)("i",{class:"scroll-icon"},"â†“",-1))])}var He={name:"ScrollToBottomButton",props:{unreadCount:{type:Number,default:0}}};const De=(0,m.A)(He,[["render",Ae],["__scopeId","data-v-ffe9ffec"]]);var Fe=De,Re=n(144);const Xe=ee();function Oe({onMessage:e}){const t=(0,Re.KR)(null),n=(0,Re.KR)("disconnected");let s=0;const o=5,i=3e3;let r=null;const a=()=>{n.value="connecting";const o="https:"===window.location.protocol?"wss":"ws",i=window.location.hostname,a="",l=a?`${i}:${a}`:i;t.value=new WebSocket(`${o}://${l}/api/chat?uuid=${Xe}`),t.value.onopen=()=>{n.value="connected",clearInterval(r),r=setInterval((()=>{u({type:"Ping",data:""})}),8888)},t.value.onmessage=t=>{try{let n=JSON.parse(t.data);if("Pang"==n.type)return;e(n)}catch(n){e({name:"System",data:t.data,time:(new Date).toLocaleTimeString()})}},t.value.onclose=()=>{n.value="disconnected",c()},t.value.onerror=e=>{n.value="disconnected",console.error("WebSocketé”™è¯¯:",e)},s=0},l=()=>{t.value&&(t.value.close(),t.value=null)},c=()=>{s<o?(s++,setTimeout((()=>{a()}),i)):console.error("è¾¾åˆ°æœ€å¤§é‡è¿žæ¬¡æ•°ï¼Œåœæ­¢é‡è¿ž")},u=e=>!(!t.value||t.value.readyState!==WebSocket.OPEN)&&(t.value.send(JSON.stringify(e)),!0);return{connectionStatus:n,connect:a,disconnect:l,sendMessage:u}}const Ke={OnlineCount:"OnlineCount",GptResponse:"GptResponse"};var Ne={name:"ChatView",components:{MessageList:de,ChatInput:$e,ConnectionStatus:Be,ScrollToBottomButton:Fe},data(){return{messages:[],username:"",isNearBottom:!0,showScrollButton:!1,unreadCount:0,connectionStatus:"disconnected",onlineCountText:"",isMobile:!1}},created(){this.username=this.generateUsername()},mounted(){this.checkMobile(),window.addEventListener("resize",this.checkMobile);const{connectionStatus:e,connect:t,disconnect:n,sendMessage:s}=Oe({onMessage:this.handleMessage});this.connect=t,this.disconnect=n,this.sendWebSocketMessage=s,this.wsConnectionStatus=e,this.connectionStatus=e.value,this.$watch((()=>this.wsConnectionStatus.value),(e=>{this.connectionStatus=e})),this.connect()},beforeUnmount(){this.disconnect(),window.removeEventListener("resize",this.checkMobile)},methods:{generateUsername(){const e=(0,Z.A)();return`User${e}`},handleMessage(e){const t=e.name===this.username,n=e.type===Ke.GptResponse,s=e.type===Ke.OnlineCount;s&&(this.onlineCountText=e.data),this.messages.push({...e,isSelf:t,isGptResponse:n,isOnlineCount:s}),this.$nextTick((()=>{const e=this.$refs.messageListRef;if(!e)return;const s=e.$refs.messageContainer.checkScrollable();if(!s)return this.showScrollButton=!1,void(this.unreadCount=0);t||n||this.isNearBottom?this.scrollToBottom():(this.unreadCount++,this.showScrollButton=!0)}))},sendMessage(e){if("connected"!==this.connectionStatus)return;if(!e.trim())return void k.warning("Please enter a message before sending.");const t={type:"Text",data:e};this.isNearBottom=!0,this.sendWebSocketMessage(t)},scrollToBottom(){this.$nextTick((()=>{this.$refs.messageListRef&&(this.$refs.messageListRef.scrollToBottom(),this.unreadCount=0,this.showScrollButton=!1,this.isNearBottom=!0)}))},handleScroll(e){this.isNearBottom=e,this.isNearBottom&&this.showScrollButton&&(this.showScrollButton=!1,this.unreadCount=0)},handleMentionUser(e){this.$refs.chatInputRef&&this.$refs.chatInputRef.addMention(e)},checkMobile(){this.isMobile=window.innerWidth<=480}}};const Pe=(0,m.A)(Ne,[["render",L],["__scopeId","data-v-73f38e2c"]]);var Ge=Pe;const ze=!1,We=[{path:ze?"/":"/chat/index.html",name:"chat",component:Ge}],qe=(0,T.aE)({history:(0,T.LA)(""),routes:We});var je=qe;const Qe=(0,s.Ef)(C);Qe.use(je),Qe.mount("#app")}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,s,o,i){if(!s){var r=1/0;for(u=0;u<e.length;u++){s=e[u][0],o=e[u][1],i=e[u][2];for(var a=!0,l=0;l<s.length;l++)(!1&i||r>=i)&&Object.keys(n.O).every((function(e){return n.O[e](s[l])}))?s.splice(l--,1):(a=!1,i<r&&(r=i));if(a){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[s,o,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,i,r=s[0],a=s[1],l=s[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in a)n.o(a,o)&&(n.m[o]=a[o]);if(l)var u=l(n)}for(t&&t(s);c<r.length;c++)i=r[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},s=self["webpackChunkchat"]=self["webpackChunkchat"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[504],(function(){return n(3375)}));s=n.O(s)})();